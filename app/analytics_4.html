<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>
<body>

<div class="container" ng-app="analytics_4" ng-controller="myctrl">
    <h2>Platform-Region relationship</h2>


    <div class="form-group">
        <label for="state" class="col-sm-2 control-label">State</label>
        <div class="col-sm-6">
            <select class="form-control" id="state" name="state" ng-model="state">

                <option value="AK">Alaska</option>
                <option value="AL">Alabama</option>
                <option value="AR">Arkansas</option>
                <option value="AZ">Arizona</option>
                <option value="CA">California</option>
                <option value="CO">Colorado</option>
                <option value="CT">Connecticut</option>
                <option value="DC">District of Columbia</option>
                <option value="DE">Delaware</option>
                <option value="FL">Florida</option>
                <option value="GA">Georgia</option>
                <option value="HI">Hawaii</option>
                <option value="IA">Iowa</option>
                <option value="ID">Idaho</option>
                <option value="IL">Illinois</option>
                <option value="IN">Indiana</option>
                <option value="KS">Kansas</option>
                <option value="KY">Kentucky</option>
                <option value="LA">Louisiana</option>
                <option value="MA">Massachusetts</option>
                <option value="MD">Maryland</option>
                <option value="ME">Maine</option>
                <option value="MI">Michigan</option>
                <option value="MN">Minnesota</option>
                <option value="MO">Missouri</option>
                <option value="MS">Mississippi</option>
                <option value="MT">Montana</option>
                <option value="NC">North Carolina</option>
                <option value="ND">North Dakota</option>
                <option value="NE">Nebraska</option>
                <option value="NH">New Hampshire</option>
                <option value="NJ">New Jersey</option>
                <option value="NM">New Mexico</option>
                <option value="NV">Nevada</option>
                <option value="NY">New York</option>
                <option value="OH">Ohio</option>
                <option value="OK">Oklahoma</option>
                <option value="OR">Oregon</option>
                <option value="PA">Pennsylvania</option>
                <option value="PR">Puerto Rico</option>
                <option value="RI">Rhode Island</option>
                <option value="SC">South Carolina</option>
                <option value="SD">South Dakota</option>
                <option value="TN">Tennessee</option>
                <option value="TX">Texas</option>
                <option value="UT">Utah</option>
                <option value="VA">Virginia</option>
                <option value="VT">Vermont</option>
                <option value="WA">Washington</option>
                <option value="WI">Wisconsin</option>
                <option value="WV">West Virginia</option>
                <option value="WY">Wyoming</option>
            </select>
        </div>
    </div>




    <br>
    <br>

    <div class="form-group">
        <label for="state" class="col-sm-2 control-label">Start Date</label>
        <div class="col-sm-2">
            <input type="date" class="form-control" id="myDate" ng-model="start_date" min="2016-06-14" max="2016-06-28">
        </div>

        <label for="state" class="col-sm-2 control-label">End Date</label>
        <div class="col-sm-2">
            <input type="date" class="form-control" id="myDate" ng-model="end_date" min="2016-06-14" max="2016-06-28">
        </div>
    </div>

    <br>

    <br>
    <div class="form-group">
        <label for="state" class="col-sm-2 control-label">Start Time</label>
        <div class="col-sm-2">
            <select class="form-control" id="time" name="time" ng-model="start_time">

                <option value="00">00</option>
                <option value="01">01</option>
                <option value="02">02</option>
                <option value="03">03</option>
                <option value="04">04</option>
                <option value="05">05</option>
                <option value="06">06</option>
                <option value="07">07</option>
                <option value="08">08</option>
                <option value="09">09</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12</option>
                <option value="13">13</option>
                <option value="14">14</option>
                <option value="15">15</option>
                <option value="16">16</option>
                <option value="17">17</option>
                <option value="18">18</option>
                <option value="19">19</option>
                <option value="20">20</option>
                <option value="21">21</option>
                <option value="22">22</option>
                <option value="23">23</option>
            </select>
        </div>

        <label for="state" class="col-sm-2 control-label">End Time</label>
        <div class="col-sm-2">
            <select class="form-control" id="time" name="time" ng-model="end_time" min={{start_time}}>

                <option value="00">00</option>
                <option value="01">01</option>
                <option value="02">02</option>
                <option value="03">03</option>
                <option value="04">04</option>
                <option value="05">05</option>
                <option value="06">06</option>
                <option value="07">07</option>
                <option value="08">08</option>
                <option value="09">09</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12</option>
                <option value="13">13</option>
                <option value="14">14</option>
                <option value="15">15</option>
                <option value="16">16</option>
                <option value="17">17</option>
                <option value="18">18</option>
                <option value="19">19</option>
                <option value="20">20</option>
                <option value="21">21</option>
                <option value="22">22</option>
                <option value="23">23</option>
            </select>
        </div>
    </div>

    <br>
    <br>
    <div class="row">
    <div class="form-group">
        <label for="state" class="col-sm-2 control-label">Designated Market Area</label>
        <div class="col-sm-3">
            <input type="text" class="form-control" id="DMA" ng-model="dma" placeholder="809 for california">
        </div>
    </div>
    </div>

    <br>
    <br>
    <div class="form-group">

        <div class="col-sm-3 col-md-offset-4">
            <input type="submit" class="btn" ng-click="submit()">
        </div>
    </div>

    <div class="row">
        <div class="form-group">

            <div class="col-sm-9 col-md-offset-2">
                <div id="piechart" style="width: 900px; height: 500px;"></div>
            </div>
        </div>
    </div>




    <div class="row">
        <div class="form-group">

            <div class="col-sm-9 col-md-offset-2">
                <div id="linechart_material" style="width: 900px; height: 500px;"></div>
            </div>
        </div>
    </div>


</div>

</body>

<script>

    var app=angular.module("analytics_4",[]);
    app.controller("myctrl",function($scope,$http){

       console.log("inside controller");




       $scope.submit=function(){



           console.log($scope.state);
           console.log($scope.start_date);
           console.log($scope.end_date);
           console.log($scope.start_time);
           console.log($scope.end_time);

           var state_req = $scope.state
           var start_date_req = $scope.start_date + ""
           var end_date_req = $scope.end_date + ""
           var start_time_req = $scope.start_time
           var end_time_req = $scope.end_time

          console.log('start:' +start_date_req)
           var date1=start_date_req.split(" ");
          //  console.log(date1)
          // // console.log(date1[2]);
          // var date2=date1[2].split("T");
          // date1=date2[0];

          var start = date1[2]

          var date2=end_date_req.split(" ");
          // // console.log(date1[2]);
          // var date4=date3[2].split("T");
          // date3=date4[0];

          var end = date2[2]

          var req_url = '/file4/state/'+ $scope.state+'/start_date/'+start+'/end_date/'
           req_url = req_url + end + '/start_time/' + $scope.start_time+ '/end_time/'+ $scope.end_time
           console.log(req_url)

           $http({
               method:'GET',
               url:req_url,
               // data:{
               //     state:$scope.state,
               //     start_date:$scope.start_date,
               //     end_date:$scope.end_date,
               //     start_time:$scope.start_time,
               //     end_time:$scope.end_time
               // }
           }).success(function mysuccess(response){
                console.log(response);
                console.log("check result 1");
                console.log(response.result1);
                console.log(response.result2);
                console.log(response.result2.length);

                console.log("response platform");
                console.log(response.result1[0].total_count);
                console.log(response.result1[0].platform);



               google.charts.load('current', {'packages':['corechart']});
               google.charts.setOnLoadCallback(drawChart);

               function drawChart() {

                   var data = google.visualization.arrayToDataTable([
                       ['Platform', 'Count per Platform'],
                       ['Desktop',     response.result1[0].total_count],
                       ['Mobile',      response.result1[1].total_count],
                       ['Tablet',  response.result1[2].total_count]

                   ]);

                   var options = {
                       title: 'Users per Platform'
                   };

                   var chart = new google.visualization.PieChart(document.getElementById('piechart'));

                   chart.draw(data, options);
               }



               /*linecharts*/

               google.charts.load('current', {'packages':['corechart']});
               google.charts.setOnLoadCallback(drawCharttwo);

               function drawCharttwo() {

                   var data = new google.visualization.DataTable();
                   data.addColumn('number', 'Hours');
                   data.addColumn('number', 'Platform 1');
                   data.addColumn('number', 'Platform 2');
                   data.addColumn('number', 'Platform 3');

                   /*hour, platform 1, platform 2, platform 3*/
                    console.log("starting for loop");
                    //var rows=[];
                   for(var i=0;i<response.result2.length;i=i+3)
                   {
                       console.log(response.result2[i].hour,response.result2[i].total_count,response.result2[i+1].total_count,response.result2[i+2].total_count);
                       data.addRow([response.result2[i].hour,response.result2[i].total_count,response.result2[i+1].total_count,response.result2[i+2].total_count]);

                   }



                   var options = {

                           title: 'Total count of user using a platform per hour',
                           //subtitle: 'Time Range'+response.result2[0].hour+' to '+response.result2[15].hour,
                           curveType:'function',
                           legend:{position:'bottom'}


                   };

                   console.log(options);
                   var chart = new google.visualization.LineChart(document.getElementById('linechart_material'));

                   chart.draw(data, options);
               }


           }).error(function myerror(err){
               console.log(err);
           })
       }


    });

</script>

</html>
