<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <style>
      .loader {
        border: 16px solid #f3f3f3;
        border-radius: 50%;
        border-top: 16px solid #3498db;
        width: 50px;
        height: 50px;
        -webkit-animation: spin 2s linear infinite;
        animation: spin 2s linear infinite;
      }

      @-webkit-keyframes spin {
        0% { -webkit-transform: rotate(0deg); }
        100% { -webkit-transform: rotate(360deg); }
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    </style>
</head>
<body>

<div class="container" ng-app="analytics_4" ng-controller="myctrl">
    <h2>Platform-Region relationship</h2>


    <div class="form-group">
        <label for="state" class="col-sm-2 control-label">State</label>
        <div class="col-sm-6">
            <select class="form-control" id="state" name="state" ng-model="state">

                <option value="AK">Alaska</option>
                <option value="AL">Alabama</option>
                <option value="AR">Arkansas</option>
                <option value="AZ">Arizona</option>
                <option value="CA">California</option>
                <option value="CO">Colorado</option>
                <option value="CT">Connecticut</option>
                <option value="DC">District of Columbia</option>
                <option value="DE">Delaware</option>
                <option value="FL">Florida</option>
                <option value="GA">Georgia</option>
                <option value="HI">Hawaii</option>
                <option value="IA">Iowa</option>
                <option value="ID">Idaho</option>
                <option value="IL">Illinois</option>
                <option value="IN">Indiana</option>
                <option value="KS">Kansas</option>
                <option value="KY">Kentucky</option>
                <option value="LA">Louisiana</option>
                <option value="MA">Massachusetts</option>
                <option value="MD">Maryland</option>
                <option value="ME">Maine</option>
                <option value="MI">Michigan</option>
                <option value="MN">Minnesota</option>
                <option value="MO">Missouri</option>
                <option value="MS">Mississippi</option>
                <option value="MT">Montana</option>
                <option value="NC">North Carolina</option>
                <option value="ND">North Dakota</option>
                <option value="NE">Nebraska</option>
                <option value="NH">New Hampshire</option>
                <option value="NJ">New Jersey</option>
                <option value="NM">New Mexico</option>
                <option value="NV">Nevada</option>
                <option value="NY">New York</option>
                <option value="OH">Ohio</option>
                <option value="OK">Oklahoma</option>
                <option value="OR">Oregon</option>
                <option value="PA">Pennsylvania</option>
                <option value="PR">Puerto Rico</option>
                <option value="RI">Rhode Island</option>
                <option value="SC">South Carolina</option>
                <option value="SD">South Dakota</option>
                <option value="TN">Tennessee</option>
                <option value="TX">Texas</option>
                <option value="UT">Utah</option>
                <option value="VA">Virginia</option>
                <option value="VT">Vermont</option>
                <option value="WA">Washington</option>
                <option value="WI">Wisconsin</option>
                <option value="WV">West Virginia</option>
                <option value="WY">Wyoming</option>
            </select>
        </div>
    </div>


    <br>

    <br>

    <br>
    <br>
    <div class="row">
    <div class="form-group">
        <label for="state" class="col-sm-2 control-label">Ad ID</label>
        <div class="col-sm-6">
            <input type="text" class="form-control" id="ad_id" ng-model="ad_id" placeholder="Enter ID">
        </div>
    </div>
    </div>

    <br>
    <br>
    <div class="form-group">

        <div class="col-sm-3 col-md-offset-4">
            <input type="submit" class="btn" ng-click="submit()">
            <br><br>
            <div id="spinner" class="loader" style="display: none;"></div>
        </div>
    </div>
<!--
    <div class="row">
        <div class="form-group">

            <div class="col-sm-9 col-md-offset-2">
                <div id="piechart" style="width: 900px; height: 500px;"></div>
            </div>
        </div>
    </div>
-->
    <div class="row">
        <div class="form-group">
            <br><br>
            <div class="col-sm-9 col-md-offset-2 text-primary">
                <h4><b id="probability_text" style="display: none;">This text is bold</b></h4>
            </div>
        </div>
    </div>




    <div class="row">
        <div class="form-group">

            <div class="col-sm-9 col-md-offset-2">
                <div id="linechart_material" style="width: 900px; height: 500px;"></div>
            </div>
        </div>
    </div>


</div>

</body>

<script>

    var app=angular.module("analytics_4",[]);
    app.controller("myctrl",function($scope,$http){

       console.log("inside controller");




       $scope.submit=function(){
          $("#probability_text").hide();
          $("#spinner").removeAttr('style');
           console.log($scope.state);
           console.log($scope.ad_id);
           // console.log($scope.end_date);
           // console.log($scope.start_time);
           // console.log($scope.end_time);
           var request_url = "http://localhost:5000/api/state/"+$scope.state+"/ad_id/"+$scope.ad_id
           //var deferred = $q.defer();
           $http({
               method:'GET',
               url: request_url,
               timeout: 500000
           }).success(function mysuccess(response){
                $("#spinner").hide();
                console.log(response);
                var probability = ((response.clicks_per_state / response.total_clicks)*(response.ctr))
                //probability = (probability/(response.total_state/response.total_us)) * 100
                probability = (probability/(1/50))
                var output_text = "The probability that Ad with id " + response.ad_id + " is clicked for the state of " + response.state
                output_text = output_text + " is " + probability + "."
                //ouis: " + str(probability) ".";
                console.log("probability is: "+probability)

                $("#probability_text").text(output_text);
                $("#probability_text").removeAttr('style');
                // deferred.resolve(data);
                // return deferred.promise
               //  console.log("check result 1");
               //  console.log(response.result1);
               //  console.log(response.result2);
               //  console.log(response.result2.length);

               //  console.log("response platform");
               //  console.log(response.result1[0].total_count);
               //  console.log(response.result1[0].platform);



               // google.charts.load('current', {'packages':['corechart']});
               // google.charts.setOnLoadCallback(drawChart);

               // function drawChart() {

               //     var data = google.visualization.arrayToDataTable([
               //         ['Platform', 'Count per Platform'],
               //         ['Desktop',     response.result1[0].total_count],
               //         ['Mobile',      response.result1[1].total_count],
               //         ['Tablet',  response.result1[2].total_count]

               //     ]);

               //     var options = {
               //         title: 'Users per Platform'
               //     };

               //     var chart = new google.visualization.PieChart(document.getElementById('piechart'));

               //     chart.draw(data, options);
               // }



               // /*linecharts*/

               // google.charts.load('current', {'packages':['line']});
               // google.charts.setOnLoadCallback(drawCharttwo);

               // function drawCharttwo() {

               //     var data = new google.visualization.DataTable();
               //     data.addColumn('number', 'Hours');
               //     data.addColumn('number', 'Platform 1');
               //     data.addColumn('number', 'Platform 2');
               //     data.addColumn('number', 'Platform 3');

               //     /*hour, platform 1, platform 2, platform 3*/
               //      console.log("starting for loop");
               //     for(var i=0;i<response.result2.length;i=i+3)
               //     {
               //         console.log(response.result2[i].hour,response.result2[i].total_count,response.result2[i+1].total_count,response.result2[i+2].total_count);
               //         data.addRows([response.result2[i].hour,response.result2[i].total_count,response.result2[i+1].total_count,response.result2[i+2].total_count]);
               //     }



               //     var options = {
               //         chart: {
               //             title: 'Total count of user using a platform per hour',
               //             subtitle: 'Time Range'+response.result2[0].hour+' to '+response.result2[15].hour,
               //         },
               //         width: 900,
               //         height: 500
               //     };

               //     var chart = new google.visualization.LineChart(document.getElementById('linechart_material'));

               //     chart.draw(data, google.charts.Line.convertOptions(options));
               // }


           }).error(function myerror(err){
               console.log(err);
               // deferred.reject(err)
               // return deferred.promise
           })
       }


    });

</script>

</html>
